# Splunk Dashboard Studio - Annotation View

A customizable Splunk Dashboard Studio dashboard that overlays annotations (events, incidents, deployments, etc.) on top of time series line charts for enhanced data visualization and correlation analysis.

## Note

This README was generated by an LLM evaluating the dashboard file with the prompt:
```
Write a README.md on how to use this Splunk dashboard studio dashboard
```
I've lightly reviewed it for accuracy, and it looks pretty good... however you should always review any code that you're planning on putting on your systems.

Dashboard Studio dashboards (on disk) are just javascript wrapped in XML. I've included a file (`annotation_view.xml`) that you can just drop into your `data/ui/views` diretory,
or the javascript that you can paste into the dashboard studio editor (`annotation_view.js`). Dashboard Studio has evolved a lot over the last few releases, and I believe you
need at least 9.1.x in order to support putting the input boxes into the body of the dashboard. 

## Overview

This dashboard allows you to visualize time series data with contextual annotations, helping you correlate metrics with significant events. It features two separate SPL query inputs - one for your main data and another for annotation events - that are combined into a single interactive line chart.

## Features

- **Dynamic SPL Input**: Enter custom searches for both main data and annotations
- **Time Range Control**: Global time picker that applies to both data sources
- **Customizable Annotations**: Control annotation labels and colors
- **Real-time Visualization**: Line chart updates automatically when queries change
- **Query Display**: Shows the current SPL queries being executed

## How to Use

### Basic Setup

1. **Set Time Range**: Use the global time range picker to select your analysis period
2. **Enter Main SPL**: Input your primary data query in the "Main SPL" field
3. **Enter Annotation SPL**: Input your annotation events query in the "Annotation SPL" field
4. The line chart will automatically update to display your data with annotations

### Main SPL Query Requirements

Your main SPL query should return time series data with:
- A `_time` field (required for x-axis)
- One or more numeric fields for the line chart
- Data should be aggregated by time (e.g., using `timechart`, `bucket`, or `bin`)

**Example Main SPL:**
```spl
index=web_logs 
| timechart span=1h count as "Page Views"
```

### Annotation SPL Query Requirements

Your annotation SPL query should return:
- A `_time` field indicating when the annotation should appear
- Optionally: `annotationLabel` field for custom labels
- Optionally: `annotationColor` field for custom colors

**Example Annotation SPL:**
```spl
index=deployment_logs source="deploy.log" 
| eval annotationLabel="Deployment: " + app_name 
| eval annotationColor="#FF0000"
| dedup _time
```

## Special Annotation Fields

The dashboard recognizes these special fields in your annotation SPL:

### annotationLabel
Controls the text label displayed for each annotation line.

**Usage:**
```spl
| eval annotationLabel="Production Deployment"
```

**Default**: If not specified, no label will be displayed

### annotationColor
Sets the color of the annotation line using hex color codes.

**Usage:**
```spl
| eval annotationColor="#FF5733"  # Orange-red
| eval annotationColor="#33FF57"  # Green
| eval annotationColor="#3357FF"  # Blue
```

**Default**: If not specified, Splunk will use default annotation colors

## Example Use Cases

### 1. Website Performance with Deployments
**Main SPL:**
```spl
index=web_metrics 
| timechart span=5m avg(response_time) as "Avg Response Time (ms)"
```

**Annotation SPL:**
```spl
index=deployment_logs 
| eval annotationLabel="Deploy " + version 
| eval annotationColor="#FFA500"
```

### 2. Server CPU with Maintenance Windows
**Main SPL:**
```spl
index=server_metrics host=web01 
| timechart span=1m avg(cpu_percent) as "CPU Usage %"
```

**Annotation SPL:**
```spl
index=maintenance_logs 
| eval annotationLabel="Maintenance: " + description 
| eval annotationColor="#800080"
```

### 3. Application Errors with Incidents
**Main SPL:**
```spl
index=app_logs level=ERROR 
| timechart span=10m count as "Error Count"
```

**Annotation SPL:**
```spl
index=incident_management status="created" 
| eval annotationLabel="Incident #" + incident_id 
| eval annotationColor="#DC143C"
```

## Tips and Best Practices

### Query Performance
- Use appropriate time spans in your `timechart` commands to balance detail with performance
- Consider using `earliest` and `latest` in your SPL if you need to override the global time range
- Add index and source filters to improve search performance

### Annotation Clarity
- Keep annotation labels concise but descriptive
- Use consistent color coding (e.g., red for incidents, green for deployments)
- Avoid overlapping annotations by using `dedup _time` if needed

### Data Correlation
- Align your main data and annotation time granularity for better correlation
- Consider using the same time span in both queries for consistency

## Troubleshooting

### No Data Appearing
- Verify your SPL queries return results in the Search app first
- Check that the time range includes data for both queries
- Ensure `_time` fields are properly formatted

### Annotations Not Showing
- Confirm your annotation SPL returns `_time` values within the chart's time range
- Check that annotation events don't have duplicate timestamps
- Verify annotation queries are returning results

### Performance Issues
- Reduce the time range for initial testing
- Add more specific filters to your SPL queries
- Consider using summary indexes for frequently-accessed data

## Advanced Customization

To modify the dashboard further:
1. Edit the dashboard in Dashboard Studio
2. Use the visual editor to adjust chart properties
3. Add additional input controls or visualizations as needed
4. Export the updated XML for backup or sharing

## Support

For Splunk-specific issues:
- Consult the Splunk Dashboard Studio documentation
- Check Splunk Community forums
- Contact your Splunk administrator

For dashboard-specific questions:
- Review the SPL query requirements above
- Test queries individually in the Search app
- Verify data exists in the specified time range